<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href="../.././style.css"></link><link rel="icon" href="../.././favicon.svg"></link><link rel="mask-icon" href="../.././favicon.svg" color="#000000"></link><link rel="prefetch" href="../.././/declarations/declaration-data.bmp" as="image"></link><title>Mathlib.Tactic.RewriteSearch</title><script defer="true" src="../.././mathjax-config.js"></script><script defer="true" src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT="../.././";</script><script>const MODULE_NAME="Mathlib.Tactic.RewriteSearch";</script><script type="module" src="../.././jump-src.js"></script><script type="module" src="../.././search.js"></script><script type="module" src="../.././expand-nav.js"></script><script type="module" src="../.././how-about.js"></script><script type="module" src="../.././instances.js"></script><script type="module" src="../.././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label><span>Documentation</span></h1><h2 class="header_filename break_within"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span></h2><form id="search_form"><input type="text" name="q" autocomplete="off"></input>&#32;<button id="search_button" onclick="javascript: form.action='../.././search.html';">Search</button></form></header><nav class="internal_nav"><p><a href="#top">return to top</a></p><p class="gh_nav_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/RewriteSearch.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href="../.././Init.html">Init</a></li><li><a href="../.././Batteries/Data/MLList/Heartbeats.html">Batteries.Data.MLList.Heartbeats</a></li><li><a href="../.././Lean/Meta/Tactic/Rewrites.html">Lean.Meta.Tactic.Rewrites</a></li><li><a href="../.././Mathlib/Data/MLList/BestFirst.html">Mathlib.Data.MLList.BestFirst</a></li><li><a href="../.././Mathlib/Algebra/Order/Group/Nat.html">Mathlib.Algebra.Order.Group.Nat</a></li><li><a href="../.././Mathlib/Data/List/EditDistance/Estimator.html">Mathlib.Data.List.EditDistance.Estimator</a></li><li><a href="../.././Mathlib/Order/Interval/Finset/Nat.html">Mathlib.Order.Interval.Finset.Nat</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Mathlib.Tactic.RewriteSearch" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Mathlib.Tactic.RewriteSearch.splitDelimiters"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">splitDelimiters</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Tactic.RewriteSearch.splitDelimiters.auxStart"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">splitDelimiters</span>.<span class="name">auxStart</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Tactic.RewriteSearch.splitDelimiters.auxEnd"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">splitDelimiters</span>.<span class="name">auxEnd</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Tactic.RewriteSearch.tokenize"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">tokenize</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Tactic.RewriteSearch.SearchNode"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Tactic.RewriteSearch.SearchNode.editCost"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">editCost</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Tactic.RewriteSearch.SearchNode.compute_rfl?"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">compute_rfl?</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Tactic.RewriteSearch.SearchNode.compute_dist?"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">compute_dist?</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Tactic.RewriteSearch.SearchNode.toString"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">toString</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Tactic.RewriteSearch.SearchNode.mk"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">mk</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Tactic.RewriteSearch.SearchNode.init"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">init</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Tactic.RewriteSearch.SearchNode.push"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">push</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Tactic.RewriteSearch.SearchNode.lastIdx"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">lastIdx</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Tactic.RewriteSearch.SearchNode.instOrd"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">instOrd</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Tactic.RewriteSearch.SearchNode.penalty"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">penalty</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Tactic.RewriteSearch.SearchNode.prio"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">prio</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Tactic.RewriteSearch.SearchNode.estimator"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">estimator</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Tactic.RewriteSearch.SearchNode.rewrite"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">rewrite</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Tactic.RewriteSearch.SearchNode.rewrites"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">rewrites</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Tactic.RewriteSearch.SearchNode.search"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">search</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Tactic.RewriteSearch.tacticRw_search_"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">tacticRw_search_</span></a></div></nav><main>
<div class="mod_doc"><h1 class="markdown-heading" id="The-rw-search-tactic">The <code>rw_search</code> tactic <a class="hover-link" href="#The-rw-search-tactic">#</a></h1><p><code>rw_search</code> attempts to solve an equality goal
by repeatedly rewriting using lemmas from the library.</p><p>If no solution is found,
the best sequence of rewrites found before <code>maxHeartbeats</code> elapses is returned.</p><p>The search is a best-first search, minimising the Levenshtein edit distance between
the pretty-printed expressions on either side of the equality.
(The strings are tokenized at spaces,
separating delimiters <code>(</code>, <code>)</code>, <code>[</code>, <code>]</code>, and <code>,</code> into their own tokens.)</p><p>The implementation avoids completely computing edit distances where possible,
only computing lower bounds sufficient to decide which path to take in the search.</p><h1 class="markdown-heading" id="Future-improvements">Future improvements <a class="hover-link" href="#Future-improvements">#</a></h1><p>We could call <code>simp</code> as an atomic step of rewriting.</p><p>The edit distance heuristic could be replaced by something else.</p><p>No effort has been made to choose the best tokenization scheme, and this should be investigated.
Moreover, the Levenshtein distance function is customizable with different weights for each token,
and it would be interesting to try optimizing these
(or dynamically updating them,
adding weight to tokens that persistently appear on one side of the equation but not the other.)</p><p>The <code>rw_search</code> tactic will rewrite by local hypotheses,
but will not use local hypotheses to discharge side conditions.
This limitation would need to be resolved in the <code>rw?</code> tactic first.</p></div><div class="decl" id="Mathlib.Tactic.RewriteSearch.splitDelimiters"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/RewriteSearch.lean#L57-L74">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.splitDelimiters"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">splitDelimiters</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">s</span> : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#List">List</a> <a href="../.././Init/Prelude.html#String">String</a></span></div></div><p>Separate a string into a list of strings by pulling off initial <code>(</code> or <code>]</code> characters,
and pulling off terminal <code>)</code>, <code>]</code>, or <code>,</code> characters.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Tactic.RewriteSearch.splitDelimiters" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Tactic.RewriteSearch.splitDelimiters.auxStart"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/RewriteSearch.lean#L60-L65">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.splitDelimiters.auxStart"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">splitDelimiters</span>.<span class="name">auxStart</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">s</span> : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">front</span> : <a href="../.././Init/Prelude.html#String.Pos">String.Pos</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">pre</span> : <span class="fn"><a href="../.././Init/Prelude.html#List">List</a> <a href="../.././Init/Prelude.html#String">String</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/Prelude.html#String.Pos">String.Pos</a> <a href="../.././Init/Prelude.html#Prod">×</a> <span class="fn"><a href="../.././Init/Prelude.html#List">List</a> <a href="../.././Init/Prelude.html#String">String</a></span></div></div><p>Pull off leading delimiters.</p></div></div><div class="decl" id="Mathlib.Tactic.RewriteSearch.splitDelimiters.auxEnd"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/RewriteSearch.lean#L66-L71">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.splitDelimiters.auxEnd"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">splitDelimiters</span>.<span class="name">auxEnd</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">s</span> : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">back</span> : <a href="../.././Init/Prelude.html#String.Pos">String.Pos</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">suff</span> : <span class="fn"><a href="../.././Init/Prelude.html#List">List</a> <a href="../.././Init/Prelude.html#String">String</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/Prelude.html#String.Pos">String.Pos</a> <a href="../.././Init/Prelude.html#Prod">×</a> <span class="fn"><a href="../.././Init/Prelude.html#List">List</a> <a href="../.././Init/Prelude.html#String">String</a></span></div></div><p>Pull off trailing delimiters.</p></div></div><div class="decl" id="Mathlib.Tactic.RewriteSearch.tokenize"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/RewriteSearch.lean#L76-L88">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.tokenize"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">tokenize</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">e</span> : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <span class="fn">(<a href="../.././Init/Prelude.html#List">List</a> <a href="../.././Init/Prelude.html#String">String</a>)</span></span></div></div><p>Tokenize a string at whitespace, and then pull off delimiters.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Tactic.RewriteSearch.tokenize" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Tactic.RewriteSearch.SearchNode"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/RewriteSearch.lean#L90-L114">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Data structure containing the history of a rewrite search.</p><ul class="structure_ext"><li id="Mathlib.Tactic.RewriteSearch.SearchNode.mk'" class="structure_ext_ctor">mk' :: (</li><ul class="structure_ext_fields"><li id="Mathlib.Tactic.RewriteSearch.SearchNode.history" class="structure_field"><div class="structure_field_info">history : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> (<a href="../.././Init/Prelude.html#Nat">ℕ</a> <a href="../.././Init/Prelude.html#Prod">×</a> <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a> <a href="../.././Init/Prelude.html#Prod">×</a> <a href="../.././Init/Prelude.html#Bool">Bool</a>)</span></div><div class="structure_field_doc"><p>The lemmas used so far.</p></div></li><li id="Mathlib.Tactic.RewriteSearch.SearchNode.mctx" class="structure_field"><div class="structure_field_info">mctx : <a href="../.././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></div><div class="structure_field_doc"><p>The metavariable context after rewriting.
We carry this around so the search can safely backtrack.</p></div></li><li id="Mathlib.Tactic.RewriteSearch.SearchNode.goal" class="structure_field"><div class="structure_field_info">goal : <a href="../.././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a></div><div class="structure_field_doc"><p>The current goal.</p></div></li><li id="Mathlib.Tactic.RewriteSearch.SearchNode.type" class="structure_field"><div class="structure_field_info">type : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a></div><div class="structure_field_doc"><p>The type of the current goal.</p></div></li><li id="Mathlib.Tactic.RewriteSearch.SearchNode.ppGoal" class="structure_field"><div class="structure_field_info">ppGoal : <a href="../.././Init/Prelude.html#String">String</a></div><div class="structure_field_doc"><p>The pretty printed current goal.</p></div></li><li id="Mathlib.Tactic.RewriteSearch.SearchNode.lhs" class="structure_field"><div class="structure_field_info">lhs : <span class="fn"><a href="../.././Init/Prelude.html#List">List</a> <a href="../.././Init/Prelude.html#String">String</a></span></div><div class="structure_field_doc"><p>The tokenization of the left-hand-side of the current goal.</p></div></li><li id="Mathlib.Tactic.RewriteSearch.SearchNode.rhs" class="structure_field"><div class="structure_field_info">rhs : <span class="fn"><a href="../.././Init/Prelude.html#List">List</a> <a href="../.././Init/Prelude.html#String">String</a></span></div><div class="structure_field_doc"><p>The tokenization of the right-hand-side of the current goal.</p></div></li><li id="Mathlib.Tactic.RewriteSearch.SearchNode.rfl?" class="structure_field"><div class="structure_field_info">rfl? : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Init/Prelude.html#Bool">Bool</a></span></div><div class="structure_field_doc"><p>Whether the current goal can be closed by <code><a href="../.././Init/Prelude.html#rfl">rfl</a></code> (or <code>none</code> if this hasn't been test yet).</p></div></li><li id="Mathlib.Tactic.RewriteSearch.SearchNode.dist?" class="structure_field"><div class="structure_field_info">dist? : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Init/Prelude.html#Nat">ℕ</a></span></div><div class="structure_field_doc"><p>The edit distance between the tokenizations of the two sides
(or <code>none</code> if this hasn't been computed yet).</p></div></li></ul><li class="structure_ext_ctor">)</li></ul><details id="instances-for-list-Mathlib.Tactic.RewriteSearch.SearchNode" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Tactic.RewriteSearch.SearchNode.editCost"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/RewriteSearch.lean#L117-L125">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.editCost"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">editCost</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Mathlib/Data/List/EditDistance/Defs.html#Levenshtein.Cost">Levenshtein.Cost</a> <a href="../.././Init/Prelude.html#String">String</a> <a href="../.././Init/Prelude.html#String">String</a> <a href="../.././Init/Prelude.html#Nat">ℕ</a></span></div></div><p>What is the cost for changing a token?
<code><a href="../.././Mathlib/Data/List/EditDistance/Defs.html#Levenshtein.defaultCost">Levenshtein.defaultCost</a></code> just uses constant cost <code>1</code> for any token.</p><p>It may be interesting to try others.
the only one I've experimented with so far is <code><a href="../.././Mathlib/Data/List/EditDistance/Defs.html#Levenshtein.stringLogLengthCost">Levenshtein.stringLogLengthCost</a></code>,
which performs quite poorly!</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.editCost">Mathlib.Tactic.RewriteSearch.SearchNode.editCost</a> <a href="../.././Init/Prelude.html#Eq">=</a> <a href="../.././Mathlib/Data/List/EditDistance/Defs.html#Levenshtein.defaultCost">Levenshtein.defaultCost</a></li></ul></details><details id="instances-for-list-Mathlib.Tactic.RewriteSearch.SearchNode.editCost" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Tactic.RewriteSearch.SearchNode.compute_rfl?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/RewriteSearch.lean#L127-L139">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.compute_rfl?"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">compute_rfl?</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">n</span> : <a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a></span></div></div><p>Check whether a goal can be solved by <code><a href="../.././Init/Prelude.html#rfl">rfl</a></code>, and fill in the <code><a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.rfl?">SearchNode.rfl?</a></code> field.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Tactic.RewriteSearch.SearchNode.compute_rfl?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Tactic.RewriteSearch.SearchNode.compute_dist?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/RewriteSearch.lean#L141-L146">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.compute_dist?"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">compute_dist?</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">n</span> : <a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a></div></div><p>Fill in the <code><a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.dist?">SearchNode.dist?</a></code> field with the edit distance between the two sides.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Tactic.RewriteSearch.SearchNode.compute_dist?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Tactic.RewriteSearch.SearchNode.toString"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/RewriteSearch.lean#L148-L159">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.toString"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">toString</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">n</span> : <a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <a href="../.././Init/Prelude.html#String">String</a></span></div></div><p>Represent a search node as string, solely for debugging.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Tactic.RewriteSearch.SearchNode.toString" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Tactic.RewriteSearch.SearchNode.mk"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/RewriteSearch.lean#L161-L178">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.mk"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">mk</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">history</span> : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> (<a href="../.././Init/Prelude.html#Nat">ℕ</a> <a href="../.././Init/Prelude.html#Prod">×</a> <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a> <a href="../.././Init/Prelude.html#Prod">×</a> <a href="../.././Init/Prelude.html#Bool">Bool</a>)</span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">goal</span> : <a href="../.././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">ctx</span> : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></span> := <a href="../.././Init/Prelude.html#Option.none">none</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a>)</span></span></div></div><p>Construct a <code><a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a></code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Tactic.RewriteSearch.SearchNode.mk" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Tactic.RewriteSearch.SearchNode.init"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/RewriteSearch.lean#L180-L181">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.init"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">init</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">goal</span> : <a href="../.././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a>)</span></span></div></div><p>Construct an initial <code><a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a></code> from a goal.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.init">Mathlib.Tactic.RewriteSearch.SearchNode.init</a> <span class="fn">goal</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.mk">Mathlib.Tactic.RewriteSearch.SearchNode.mk</a> <a href="../.././Init/Prelude.html#List.toArray">#[</a><a href="../.././Init/Prelude.html#List.toArray">]</a> <span class="fn">goal</span></span></li></ul></details><details id="instances-for-list-Mathlib.Tactic.RewriteSearch.SearchNode.init" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Tactic.RewriteSearch.SearchNode.push"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/RewriteSearch.lean#L182-L185">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.push"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">push</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">n</span> : <a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">expr</span> : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">symm</span> : <a href="../.././Init/Prelude.html#Bool">Bool</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">k</span> : <a href="../.././Init/Prelude.html#Nat">ℕ</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">g</span> : <a href="../.././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">ctx</span> : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></span> := <a href="../.././Init/Prelude.html#Option.none">none</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a>)</span></span></div></div><p>Add an additional step to the <code><a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a></code> history.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">n</span>.<a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.push">push</a></span> <span class="fn">expr</span> <span class="fn">symm</span> <span class="fn">k</span> <span class="fn">g</span> <span class="fn">ctx</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.mk">Mathlib.Tactic.RewriteSearch.SearchNode.mk</a> <span class="fn">(<span class="fn"><span class="fn"><span class="fn">n</span>.<a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.history">history</a></span>.<a href="../.././Init/Prelude.html#Array.push">push</a></span> <a href="../.././Init/Prelude.html#Prod.mk">(</a><span class="fn">k</span><a href="../.././Init/Prelude.html#Prod.mk">,</a> <span class="fn">expr</span><a href="../.././Init/Prelude.html#Prod.mk">,</a> <span class="fn">symm</span><a href="../.././Init/Prelude.html#Prod.mk">)</a>)</span> <span class="fn">g</span> <span class="fn">ctx</span></span></li></ul></details><details id="instances-for-list-Mathlib.Tactic.RewriteSearch.SearchNode.push" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Tactic.RewriteSearch.SearchNode.lastIdx"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/RewriteSearch.lean#L187-L191">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.lastIdx"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">lastIdx</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">n</span> : <a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/Prelude.html#Nat">ℕ</a></div></div><p>Report the index of the most recently applied lemma, in the ordering returned by <code>rw?</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">n</span>.<a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.lastIdx">lastIdx</a></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn">match <span class="fn"><span class="fn"><span class="fn">n</span>.<a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.history">history</a></span>.<a href="../.././Init/Data/Array/Basic.html#Array.back?">back?</a></span> with
  | <span class="fn"><a href="../.././Init/Prelude.html#Option.some">some</a> <a href="../.././Init/Prelude.html#Prod.mk">(</a><span class="fn">k</span><a href="../.././Init/Prelude.html#Prod.mk">,</a> <span class="fn">snd</span><a href="../.././Init/Prelude.html#Prod.mk">)</a></span> =&gt; <span class="fn">k</span>
  | <a href="../.././Init/Prelude.html#Option.none">none</a> =&gt; <span class="fn">0</span></span></li></ul></details><details id="instances-for-list-Mathlib.Tactic.RewriteSearch.SearchNode.lastIdx" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Tactic.RewriteSearch.SearchNode.instOrd"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/RewriteSearch.lean#L193-L194">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.instOrd"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">instOrd</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Data/Ord.html#Ord">Ord</a> <a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Mathlib.Tactic.RewriteSearch.SearchNode.penalty"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/RewriteSearch.lean#L196-L225">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.penalty"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">penalty</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">n</span> : <a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/Prelude.html#Nat">ℕ</a></div></div><p>A somewhat arbitrary penalty function.
Note that <code>n.<a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.lastIdx">lastIdx</a></code> penalizes using later lemmas from a particular call to <code>rw?</code> at a node,
but once we have moved on to the next node these penalties are &quot;forgiven&quot;.</p><p>(You might in interpret this as encouraging
the algorithm to &quot;trust&quot; the ordering provided by <code>rw?</code>.)</p><p>I tried out a various (positive) linear combinations of
<code>.history.size</code>, <code>.<a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.lastIdx">lastIdx</a></code>, and <code>.ppGoal.length</code> (and also the <code>.log2</code>s of these).</p><ul>
<li><code>.lastIdx.log2</code> is quite good, and the best coefficient is around 1.</li>
<li><code>.<a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.lastIdx">lastIdx</a> / 10</code> is almost as good.</li>
<li><code>.history.size</code> makes things worse (similarly with <code>.log2</code>).</li>
<li><code>.ppGoal.length</code> makes little difference (similarly with <code>.log2</code>).
Here testing consisting of running the current <code>rw_search</code> test suite,
rejecting values for which any failed, and trying to minimize the run time reported by</li>
</ul><pre><code class="language-shell">lake build &amp;&amp;  \
time (lake env lean test/RewriteSearch/Basic.lean; \
  lake env lean test/RewriteSearch/Polynomial.lean)
</code></pre><p>With a larger test suite it might be worth running this minimization again,
and considering other penalty functions.</p><p>(If you do this, please choose a penalty function which is in the interior of the region
where the test suite works.
I think it would be a bad idea to optimize the run time at the expense of fragility.)</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">n</span>.<a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.penalty">penalty</a></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">n</span>.<a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.lastIdx">lastIdx</a></span>.<a href="../.././Init/Data/Nat/Log2.html#Nat.log2">log2</a></span> <a href="../.././Init/Prelude.html#HAdd.hAdd">+</a> <span class="fn"><span class="fn"><span class="fn"><span class="fn">n</span>.<a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.ppGoal">ppGoal</a></span>.<a href="../.././Init/Data/String/Basic.html#String.length">length</a></span>.<a href="../.././Init/Data/Nat/Log2.html#Nat.log2">log2</a></span></li></ul></details><details id="instances-for-list-Mathlib.Tactic.RewriteSearch.SearchNode.penalty" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Tactic.RewriteSearch.SearchNode.prio"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/RewriteSearch.lean#L227-L229">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.prio"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">prio</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">n</span> : <a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Core.html#Thunk">Thunk</a> <a href="../.././Init/Prelude.html#Nat">ℕ</a></span></div></div><p>The priority function for search is Levenshtein distance plus a penalty.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">n</span>.<a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.prio">prio</a></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../.././Init/Core.html#Thunk.pure">Thunk.pure</a> <span class="fn"><span class="fn">n</span>.<a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.penalty">penalty</a></span></span> <a href="../.././Init/Prelude.html#HAdd.hAdd">+</a>     <a href="../.././Init/Core.html#Thunk.mk">{</a> <span class="fn">fn</span> := <span class="fn">fun (<span class="fn">x</span> : <a href="../.././Init/Prelude.html#Unit">Unit</a>) =&gt; <span class="fn"><a href="../.././Mathlib/Data/List/EditDistance/Defs.html#levenshtein">levenshtein</a> <a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.editCost">Mathlib.Tactic.RewriteSearch.SearchNode.editCost</a> <span class="fn"><span class="fn">n</span>.<a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.lhs">lhs</a></span> <span class="fn"><span class="fn">n</span>.<a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.rhs">rhs</a></span></span></span> <a href="../.././Init/Core.html#Thunk.mk">}</a></li></ul></details><details id="instances-for-list-Mathlib.Tactic.RewriteSearch.SearchNode.prio" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Tactic.RewriteSearch.SearchNode.estimator"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/RewriteSearch.lean#L230-L232">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.estimator"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">estimator</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">n</span> : <a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>We can obtain lower bounds, and improve them, for the Levenshtein distance.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">n</span>.<a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.estimator">estimator</a></span> <a href="../.././Init/Prelude.html#Eq">=</a>   (<span class="fn"><a href="../.././Mathlib/Order/Estimator.html#Estimator.trivial">Estimator.trivial</a> <span class="fn"><span class="fn">n</span>.<a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.penalty">penalty</a></span></span> <a href="../.././Init/Prelude.html#Prod">×</a> <span class="fn"><a href="../.././Mathlib/Data/List/EditDistance/Estimator.html#LevenshteinEstimator">LevenshteinEstimator</a> <a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.editCost">Mathlib.Tactic.RewriteSearch.SearchNode.editCost</a> <span class="fn"><span class="fn">n</span>.<a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.lhs">lhs</a></span> <span class="fn"><span class="fn">n</span>.<a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.rhs">rhs</a></span></span>)</li></ul></details><details id="instances-for-list-Mathlib.Tactic.RewriteSearch.SearchNode.estimator" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Tactic.RewriteSearch.SearchNode.rewrite"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/RewriteSearch.lean#L234-L239">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.rewrite"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">rewrite</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">n</span> : <a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">r</span> : <a href="../.././Lean/Meta/Tactic/Rewrites.html#Lean.Meta.Rewrites.RewriteResult">Lean.Meta.Rewrites.RewriteResult</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">k</span> : <a href="../.././Init/Prelude.html#Nat">ℕ</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a>)</span></span></div></div><p>Given a <code>RewriteResult</code> from the <code>rw?</code> tactic, create a new <code><a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a></code> with the new goal.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">n</span>.<a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.rewrite">rewrite</a></span> <span class="fn">r</span> <span class="fn">k</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.withMCtx">Lean.Meta.withMCtx</a> <span class="fn"><span class="fn">r</span>.<a href="../.././Lean/Meta/Tactic/Rewrites.html#Lean.Meta.Rewrites.RewriteResult.mctx">mctx</a></span> <span class="fn">do
    let <span class="fn">goal'</span> ← <span class="fn"><span class="fn"><span class="fn"><span class="fn">n</span>.<a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.goal">goal</a></span>.<a href="../.././Lean/Meta/Tactic/Replace.html#Lean.MVarId.replaceTargetEq">replaceTargetEq</a></span> <span class="fn"><span class="fn"><span class="fn">r</span>.<a href="../.././Lean/Meta/Tactic/Rewrites.html#Lean.Meta.Rewrites.RewriteResult.result">result</a></span>.<a href="../.././Lean/Meta/Tactic/Rewrite.html#Lean.Meta.RewriteResult.eNew">eNew</a></span> <span class="fn"><span class="fn"><span class="fn">r</span>.<a href="../.././Lean/Meta/Tactic/Rewrites.html#Lean.Meta.Rewrites.RewriteResult.result">result</a></span>.<a href="../.././Lean/Meta/Tactic/Rewrite.html#Lean.Meta.RewriteResult.eqProof">eqProof</a></span></span>
    let <span class="fn">__do_lift</span> ← <a href="../.././Lean/MetavarContext.html#Lean.MonadMCtx.getMCtx">Lean.getMCtx</a>
    <span class="fn"><span class="fn"><span class="fn">n</span>.<a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.push">push</a></span> <span class="fn"><span class="fn">r</span>.<a href="../.././Lean/Meta/Tactic/Rewrites.html#Lean.Meta.Rewrites.RewriteResult.expr">expr</a></span> <span class="fn"><span class="fn">r</span>.<a href="../.././Lean/Meta/Tactic/Rewrites.html#Lean.Meta.Rewrites.RewriteResult.symm">symm</a></span> <span class="fn">k</span> <span class="fn">goal'</span> <span class="fn">(<a href="../.././Init/Prelude.html#Option.some">some</a> <span class="fn">__do_lift</span>)</span></span></span></span></li></ul></details><details id="instances-for-list-Mathlib.Tactic.RewriteSearch.SearchNode.rewrite" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Tactic.RewriteSearch.SearchNode.rewrites"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/RewriteSearch.lean#L241-L258">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.rewrites"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">rewrites</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">hyps</span> : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> (<a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a> <a href="../.././Init/Prelude.html#Prod">×</a> <a href="../.././Init/Prelude.html#Bool">Bool</a> <a href="../.././Init/Prelude.html#Prod">×</a> <a href="../.././Init/Prelude.html#Nat">ℕ</a>)</span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">lemmas</span> : <span class="fn"><a href="../.././Lean/Meta/LazyDiscrTree.html#Lean.Meta.LazyDiscrTree.ModuleDiscrTreeRef">Lean.Meta.LazyDiscrTree.ModuleDiscrTreeRef</a> (<a href="../.././Init/Prelude.html#Lean.Name">Lean.Name</a> <a href="../.././Init/Prelude.html#Prod">×</a> <a href="../.././Lean/Meta/Tactic/Rewrites.html#Lean.Meta.Rewrites.RwDirection">Lean.Meta.Rewrites.RwDirection</a>)</span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">forbidden</span> : <a href="../.././Lean/Data/NameMap/Basic.html#Lean.NameSet">Lean.NameSet</a> := <a href="../.././Init/Core.html#EmptyCollection.emptyCollection">∅</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">n</span> : <a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Batteries/Data/MLList/Basic.html#MLList">MLList</a> <a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a></span></div></div><p>Given a pair of <code>DiscrTree</code> trees
indexing all rewrite lemmas in the imported files and the current file,
try rewriting the current goal in the <code><a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a></code> by one of them,
returning a <code><a href="../.././Batteries/Data/MLList/Basic.html#MLList">MLList</a> MetaM <a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a></code>, i.e. a lazy list of next possible goals.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Tactic.RewriteSearch.SearchNode.rewrites" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Tactic.RewriteSearch.SearchNode.search"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/RewriteSearch.lean#L260-L284">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode.search"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">SearchNode</span>.<span class="name">search</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">n</span> : <a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">stopAtRfl </span><span class="fn">stopAtDistZero</span> : <a href="../.././Init/Prelude.html#Bool">Bool</a> := <a href="../.././Init/Prelude.html#Bool.true">true</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">forbidden</span> : <a href="../.././Lean/Data/NameMap/Basic.html#Lean.NameSet">Lean.NameSet</a> := <a href="../.././Init/Core.html#EmptyCollection.emptyCollection">∅</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">maxQueued</span> : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Init/Prelude.html#Nat">ℕ</a></span> := <a href="../.././Init/Prelude.html#Option.none">none</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Batteries/Data/MLList/Basic.html#MLList">MLList</a> <a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a></span></div></div><p>Perform best first search on the graph of rewrites from the specified <code><a href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.SearchNode">SearchNode</a></code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Tactic.RewriteSearch.SearchNode.search" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Tactic.RewriteSearch.tacticRw_search_"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/RewriteSearch.lean#L290-L305">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/RewriteSearch.html#Mathlib.Tactic.RewriteSearch.tacticRw_search_"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">RewriteSearch</span>.<span class="name">tacticRw_search_</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/Prelude.html#Lean.ParserDescr">Lean.ParserDescr</a></div></div><p><code>rw_search</code> attempts to solve an equality goal
by repeatedly rewriting using lemmas from the library.</p><p>If no solution is found,
the best sequence of rewrites found before <code>maxHeartbeats</code> elapses is returned.</p><p>The search is a best-first search, minimising the Levenshtein edit distance between
the pretty-printed expressions on either side of the equality.
(The strings are tokenized at spaces,
separating delimiters <code>(</code>, <code>)</code>, <code>[</code>, <code>]</code>, and <code>,</code> into their own tokens.)</p><p>You can use <code>rw_search [-my_lemma, -my_theorem]</code>
to prevent <code>rw_search</code> from using the names theorems.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Tactic.RewriteSearch.tacticRw_search_" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div></main>
<nav class="nav"><iframe src="../.././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>