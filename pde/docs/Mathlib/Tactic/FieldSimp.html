<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href="../.././style.css"></link><link rel="icon" href="../.././favicon.svg"></link><link rel="mask-icon" href="../.././favicon.svg" color="#000000"></link><link rel="prefetch" href="../.././/declarations/declaration-data.bmp" as="image"></link><title>Mathlib.Tactic.FieldSimp</title><script defer="true" src="../.././mathjax-config.js"></script><script defer="true" src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT="../.././";</script><script>const MODULE_NAME="Mathlib.Tactic.FieldSimp";</script><script type="module" src="../.././jump-src.js"></script><script type="module" src="../.././search.js"></script><script type="module" src="../.././expand-nav.js"></script><script type="module" src="../.././how-about.js"></script><script type="module" src="../.././instances.js"></script><script type="module" src="../.././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label><span>Documentation</span></h1><h2 class="header_filename break_within"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">FieldSimp</span></h2><form id="search_form"><input type="text" name="q" autocomplete="off"></input>&#32;<button id="search_button" onclick="javascript: form.action='../.././search.html';">Search</button></form></header><nav class="internal_nav"><p><a href="#top">return to top</a></p><p class="gh_nav_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/FieldSimp.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href="../.././Init.html">Init</a></li><li><a href="../.././Mathlib/Tactic/FieldSimp/Discharger.html">Mathlib.Tactic.FieldSimp.Discharger</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Mathlib.Tactic.FieldSimp" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Mathlib.Tactic.FieldSimp.fieldSimpExcluded"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">FieldSimp</span>.<span class="name">fieldSimpExcluded</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Tactic.FieldSimp.fieldSimp"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">FieldSimp</span>.<span class="name">fieldSimp</span></a></div></nav><main>
<div class="mod_doc"><h1 class="markdown-heading" id="field-simp-tactic"><code>field_simp</code> tactic <a class="hover-link" href="#field-simp-tactic">#</a></h1><p>Tactic to clear denominators in algebraic expressions, based on <code>simp</code> with a specific simpset.</p></div><div class="decl" id="Mathlib.Tactic.FieldSimp.fieldSimpExcluded"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/FieldSimp.lean#L21-L39">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/FieldSimp.html#Mathlib.Tactic.FieldSimp.fieldSimpExcluded"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">FieldSimp</span>.<span class="name">fieldSimpExcluded</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#List">List</a> <a href="../.././Init/Prelude.html#Lean.Name">Lean.Name</a></span></div></div><p>The list of lemma's that aren't used in <code>field_simp</code>.</p><p><code><a href="../.././Mathlib/Algebra/Group/Defs.html#one_div">one_div</a></code>, <code><a href="../.././Mathlib/Algebra/GroupWithZero/Defs.html#mul_eq_zero">mul_eq_zero</a></code> and <code><a href="../.././Mathlib/Algebra/Group/Units/Defs.html#one_divp">one_divp</a></code> are excluded because we don't want those rewrites.</p><p>The remaining constants are excluded for efficiency. These are lemmas consisting of just
<code>*</code>, <code>/</code> and <code>=</code> that are applicable in a typeclass that can't be a field.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Tactic.FieldSimp.fieldSimpExcluded" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Tactic.FieldSimp.fieldSimp"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/90c0e186fd333cbdddbe0e5148aa3cd2d24dcf9a/Mathlib/Tactic/FieldSimp.lean#L41-L102">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/FieldSimp.html#Mathlib.Tactic.FieldSimp.fieldSimp"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">FieldSimp</span>.<span class="name">fieldSimp</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/Prelude.html#Lean.ParserDescr">Lean.ParserDescr</a></div></div><p>The goal of <code>field_simp</code> is to reduce an expression in a field to an expression of the form <code>n / d</code>
where neither <code>n</code> nor <code>d</code> contains any division symbol, just using the simplifier (with a carefully
crafted simpset named <code>field_simps</code>) to reduce the number of division symbols whenever possible by
iterating the following steps:</p><ul>
<li>write an inverse as a division</li>
<li>in any product, move the division to the right</li>
<li>if there are several divisions in a product, group them together at the end and write them as a
single division</li>
<li>reduce a sum to a common denominator</li>
</ul><p>If the goal is an equality, this simpset will also clear the denominators, so that the proof
can normally be concluded by an application of <code>ring</code>.</p><p><code>field_simp [hx, hy]</code> is a short form for
<code>simp (disch := field_simp_discharge) [-one_div, -one_divp, -mul_eq_zero, hx, hy, field_simps]</code></p><p>Note that this naive algorithm will not try to detect common factors in denominators to reduce the
complexity of the resulting expression. Instead, it relies on the ability of <code>ring</code> to handle
complicated expressions in the next step.</p><p>As always with the simplifier, reduction steps will only be applied if the preconditions of the
lemmas can be checked. This means that proofs that denominators are nonzero should be included. The
fact that a product is nonzero when all factors are, and that a power of a nonzero number is
nonzero, are included in the simpset, but more complicated assertions (especially dealing with sums)
should be given explicitly. If your expression is not completely reduced by the simplifier
invocation, check the denominators of the resulting expression and provide proofs that they are
nonzero to enable further progress.</p><p>To check that denominators are nonzero, <code>field_simp</code> will look for facts in the context, and
will try to apply <code><a href="../.././Mathlib/Tactic/NormNum/Core.html#norm_num">norm_num</a></code> to close numerical goals.</p><p>The invocation of <code>field_simp</code> removes the lemma <code><a href="../.././Mathlib/Algebra/Group/Defs.html#one_div">one_div</a></code> from the simpset, as this lemma
works against the algorithm explained above. It also removes
<code><a href="../.././Mathlib/Algebra/GroupWithZero/Defs.html#mul_eq_zero">mul_eq_zero</a> : x * y = 0 ↔ x = 0 ∨ y = 0</code>, as <code><a href="../.././Mathlib/Tactic/NormNum/Core.html#norm_num">norm_num</a></code> can not work on disjunctions to
close goals of the form <code>24 ≠ 0</code>, and replaces it with <code><a href="../.././Mathlib/Algebra/GroupWithZero/Basic.html#mul_ne_zero">mul_ne_zero</a> : x ≠ 0 → y ≠ 0 → x * y ≠ 0</code>
creating two goals instead of a disjunction.</p><p>For example,</p><pre><code class="language-lean">example (a b c d x y : ℂ) (hx : x ≠ 0) (hy : y ≠ 0) :
    a + b / x + c / x^2 + d / x^3 = a + x⁻¹ * (y * b / y + (d / x + c) / x) := by
  field_simp
  ring
</code></pre><p>Moreover, the <code>field_simp</code> tactic can also take care of inverses of units in
a general (commutative) monoid/ring and partial division <code>/ₚ</code>, see <code>Algebra.Group.<a href="../.././Mathlib/Algebra/Group/Units/Defs.html#Units">Units</a></code>
for the definition. Analogue to the case above, the lemma <code><a href="../.././Mathlib/Algebra/Group/Units/Defs.html#one_divp">one_divp</a></code> is removed from the simpset
as this works against the algorithm. If you have objects with an <code><a href="../.././Mathlib/Algebra/Group/Units/Defs.html#IsUnit">IsUnit</a> x</code> instance like
<code>(x : R) (hx : <a href="../.././Mathlib/Algebra/Group/Units/Defs.html#IsUnit">IsUnit</a> x)</code>, you should lift them with
<code>lift x to Rˣ using <a href="../.././Init/Prelude.html#id">id</a> hx; rw [IsUnit.unit_of_val_units] clear hx</code>
before using <code>field_simp</code>.</p><p>See also the <code>cancel_denoms</code> tactic, which tries to do a similar simplification for expressions
that have numerals in denominators.
The tactics are not related: <code>cancel_denoms</code> will only handle numeric denominators, and will try to
entirely remove (numeric) division from the expression by multiplying by a factor.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Tactic.FieldSimp.fieldSimp" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="mod_doc"><p>We register <code>field_simp</code> with the <code>hint</code> tactic.</p></div></main>
<nav class="nav"><iframe src="../.././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>